<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="highlight/styles/monokai-sublime.css">
	<style type="text/css">
		body{
			/*font-family: "微软雅黑";*/
		}
		pre code {
		    font: normal 10pt Consolas, Monaco, monospace;
		}
	</style>
</head>
<body>

<pre>
	<code class="css">@font-face {
  font-family: Chunkfive; src: url('Chunkfive.otf');
}

body, .usertext {
  color: #F0F0F0; background: #600;
  font-family: Chunkfive, sans;
}

@import url(print.css);
@media print {
  a[href^=http]::after {
    content: attr(href)
  }
}
.a{
  font-size:12px;
}
</code>
</pre>

<pre>
	<code class="bash">#!/bin/bash

###### CONFIG
ACCEPTED_HOSTS="/root/.hag_accepted.conf"
BE_VERBOSE=false

if [ "$UID" -ne 0 ]
then
 echo "Superuser rights required"
 exit 2
fi

genApacheConf(){
 echo -e "# Host ${HOME_DIR}$1/$2 :"
}</code>
</pre>
<pre>
	<code class="python">@requires_authorization
def somefunc(param1='', param2=0):
    r'''A docstring'''
    if param1 > param2: # interesting
        print 'Gre\'ater'
    return (param2 - param1 + 1 + 0b10l) or None

class SomeClass:
    pass

>>> message = '''interpreter
... prompt'''</code>
</pre>

<pre>
	<code># The Greeter class
class Greeter
  def initialize(name)
    @name = name.capitalize
  end

  def salute
    puts "Hello #{@name}!"
  end
end

g = Greeter.new("world")
g.salute</code>
</pre>

<p><h3>Timer</h3></p>
<p>
 相信大家都已经非常熟悉 java.util.Timer 了，
 它是最简单的一种实现任务调度的方法，下面给出一个具体的例子：
 清单 1. 使用 Timer 进行任务调度
 </p>
<pre>
  <code>package testtimer;

import java.util.Timer;
import java.util.TimerTask;

public class TimerTest extends TimerTask{
  
  private String jobName = "";
  
  public TimerTest(String jobName){
    super();
    this.jobName = jobName;
  }

  @Override
  public void run() {
    System.out.println("execute " + jobName);
  }
  
  public static void main(String[] args) {
    Timer timer = new Timer();
    long delay1 = 1 * 1000;
    long period1 = 1000;
    
    // 从现在开始 1 秒钟之后，每隔 1 秒钟执行一次 job1
    timer.schedule(new TimerTest("job1"), delay1, period1);
    long delay2 = 2 * 1000;
    long period2 = 2000;
    
    // 从现在开始 2 秒钟之后，每隔 2 秒钟执行一次 job2 
    timer.schedule(new TimerTest("job2"), delay2, period2);
    
  }
}</code>
</pre>
<p>
使用 Timer 实现任务调度的核心类是 Timer 和 TimerTask。
其中 Timer 负责设定 TimerTask 的起始与间隔执行时间。
使用者只需要创建一个 TimerTask 的继承类，
实现自己的 run 方法，然后将其丢给 Timer 去执行即可。
Timer 的设计核心是一个 TaskList 和一个 TaskThread。
Timer 将接收到的任务丢到自己的 TaskList 中，TaskList 按照 Task 的最初执行时间进行排序。
TimerThread 在创建 Timer 时会启动成为一个守护线程。
这个线程会轮询所有任务，找到一个最近要执行的任务，然后休眠，
当到达最近要执行任务的开始时间点，TimerThread 被唤醒并执行该任务。
之后 TimerThread 更新最近一个要执行的任务，继续休眠。
Timer 的优点在于简单易用，但由于所有任务都是由同一个线程来调度，
因此所有任务都是串行执行的，同一时间只能有一个任务在执行，
前一个任务的延迟或异常都将会影响到之后的任务。
</p>



<script type="text/javascript" src="highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>